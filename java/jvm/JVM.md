## JVM이란?

JVM이란 자바 프로그램을 실행시켜주는 가상머신으로 다음과같이 4가지로 구성되어 있다.

- Class Loader
  - 클래스로더는 바이트코드를 읽어와 Runtime Data Area에 적재하는 역할을 수행한다. 
- Execution Engine
  - 자바 실행엔진으로 Runtime Data Area에 적재된 바이트코드를 명령어 단위로 읽어서 실행시키는 역할을 수행한다.
- Garbage Collector
  - 더이상 참조되지 않는 객체들을 메모리에서 해제해주는 역할을 수행한다.
- Runtime Data Area
  - OS로부터 할당받은 메모리 영역으로 프로그램 실행에 필요한 데이터가 적재된다.

![jvm](https://github.com/gamzagamza/study-note/blob/master/java/jvm/images/jvm.png?raw=true)



## 자바 프로그램을 실행시키기 위한 과정

1. JVM이 OS로부터 필요로하는 메모리를 할당받는다.
2. Java Source(.java)를 Java Compiler(javac.exe)를 통해 Java Byte Code(.class)로 컴파일 한다.
3. Class Loader를 통해 Class파일들을 Runtime Data Area로 로딩시킨다.
4. Execution Engine이 Runtime Data Area에 로딩된 Byte Code를 해석하고 실행시킨다.



## 자바는 컴파일과 인터프리터 방식이 혼합된 언어

컴파일 언어란 소스코드를 컴파일러를 통해 컴파일하여 컴퓨터가 알아들을 수 있는 기계어로 변환한 후 CPU가 변환되어진 기계어를 읽어 실행하는 방식으로 동작하는 언어를 말한다.

소스코드의 양이 매우 많을경우 컴파일에 걸리는 시간이 증가하지만 이미 기계어로 번역되어있기 때문에 추가적인 해석이 필요하지않아 프로그램 실행시에는 매우 빠르다는 장점이 있다.

대표적인 컴파일언어로 C/C++이 있다.



인터프리터란 소스코드를 미리 컴파일하지 않고 코드를 실행할 때마다 컴퓨터가 알아들을 수 있도록 해석해 동작하는 언어를 말한다. 컴파일하는 과정이 존재하지않아 별도의 컴파일 시간이 필요없고 바로 실행시켜볼 수 있다는 장점이 있지만 실행시에는 컴파일 언어보다 속도가 느리다는 단점이 있다.

대표적인 인터프리터 방식의 언어로 Python이 있다.



자바는 소스코드를 JVM이 읽을 수 있는 바이트코드로 변환하는 컴파일 과정을 가지기 때문에 컴파일 언어의 특성을 가지면서

Execution Engine이 바이트코드를 그때그때 해석해 실행시키는 인터프리터 언어의 특성을 가지고 있다.

그렇기 때문에 자바는 컴파일 언어이면서 동시에 인터프리터 방식의 언어이다.



## JIT 컴파일러

자바의 단점하면 항상 언급되는 것이 속도이다. 자바는 인터프리터 방식으로 명령어를 실행시키기 때문에 컴파일 언어들에 비해 속도가 느리다는 단점을 가지고 있다. 이러한 단점을 보완할 수 없을까 해서 나온것이 JIT(Just In Time) 컴파일러다.

JIT는 기계어로 해석된 명령을 캐싱하는 역할을 한다. 그래서 이미 캐싱된 명령어는 다시 해석될 필요없이 바로 실행할 수 있게되어 속도가 향상되게 된다.

JIT는 모든 명령어들을 캐싱하지 않는다. 특정 임계치를 벗어나는 코드에대해서 캐싱을 수행하는데 임계치는 얼만큼 자주 호출되는지와 반복되는지를 가지고 계산된다. 



## Runtime Data Area

Runtime Data Area는 5가지 영역으로 구성되어있는데 각 영역에 대해서 알아보자.



**Method Area**

클래스 영역, 메소드 영역, 스태틱 영역등으로 불리며 클래스로더에 의해 로딩된 바이트코드, 클래스 또는 인터페이스의 메타정보가 저장된다.

클래스는 사용시점에 로딩되며 모든 클래스가 실행시점에 로딩되지 않는다.

**Stack Area**

각 스레드별로 생성되며 지역변수 매개변수 등 임시값이 저장되는 공간이다. 메소드가 호출될 때마다 새로운 프레임이 추가되며 종료될 시 프레임이 삭제된다.

**Heap Area**

모든 스레드가 공유하며 객체들의 인스턴스가 저장되는 공간으로 GC의 대상이 되는 영역이다.

Heap은 Young영역과 Old영역으로 나뉘는데 해당 영역들은 GC와 깊은 관련이 있으므로 GC를 다룰때 같이 알아보도록 하자.

**PC Register**

각 스레드별로 생성되며 스레드가 각자 어떤 부분을 실행해야하는지를 기록하는 영역이다.

수행중인 JVM 명령의 주소값을 가진다.

**Native Method Stack**

자바가 아닌 다른 언어로 작성된 코드가 저장되는 영역이다.